---
export interface Props {
  company: string;
  companyUrl?: string;
  role: string;
  period: string;
  current?: boolean;
  logo?: string;
  description?: string[];
}

const { company, companyUrl, role, period, current = false, logo, description } = Astro.props;

// Generate initials as fallback for missing logos
const getInitials = (name: string) => {
  return name.split(' ').map(word => word.charAt(0)).join('').toUpperCase().slice(0, 2);
};
---

<div class="glass-card mb-4 sm:mb-6 lg:mb-section">
  <div class="grid grid-cols-1 sm:grid-cols-[3rem_1fr] lg:grid-cols-[4rem_1fr] gap-4 sm:gap-6">
    <!-- Logo Column -->
    <div class="w-12 h-12 sm:w-12 sm:h-12 lg:w-16 lg:h-16 flex items-center justify-center flex-shrink-0 mx-auto sm:mx-0">
      {logo ? (
        <img 
          src={logo} 
          alt={`Logo de ${company}`} 
          class="w-full h-full object-contain rounded-xl lazy-load"
          loading="lazy"
          decoding="async"
          fetchpriority="low"
          width="64"
          height="64"
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
        />
      ) : null}
      <div 
        class={`w-full h-full rounded-xl bg-cv-accent text-white flex items-center justify-center text-sm font-semibold ${logo ? 'hidden' : 'flex'}`}
        aria-label={`Initiales de ${company}`}
      >
        {getInitials(company)}
      </div>
    </div>
    
    <!-- Content Column -->
    <div>
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between mb-3 sm:mb-4 text-center sm:text-left">
        <div class="mb-2 sm:mb-0">
          <h3 class="text-lg sm:text-xl lg:text-company text-cv-content font-semibold font-lora">
            {companyUrl ? (
              <a 
                href={companyUrl} 
                target="_blank" 
                rel="noopener noreferrer" 
                class="hover:text-cv-accent transition-colors hover:underline focus:outline-none focus:ring-2 focus:ring-cv-accent focus:rounded"
                aria-label={`Voir le projet chez ${company} (ouvre dans un nouvel onglet)`}
              >
                {company}
              </a>
            ) : (
              company
            )}
          </h3>
          <p class="text-base sm:text-lg lg:text-role text-cv-muted">{role}</p>
        </div>
        
        <!-- Period Badge -->
        <div class="flex justify-center sm:justify-end">
          <span class="inline-flex items-center gap-1.5 px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-cv-accent text-white rounded-sm border border-cv-accent shadow-sm font-medium">
            <svg width="14" height="14" viewBox="0 0 32 32" fill="white" class="flex-shrink-0 sm:w-4 sm:h-4">
              <path d="M26 4h-4V2h-2v2h-8V2h-2v2H6a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h20a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zM6 6h4v2h2V6h8v2h2V6h4v4H6zm0 6h20v14H6z"/>
            </svg>
            <span class="hidden sm:inline font-ibm-plex-mono">{period}</span>
            <span class="sm:hidden font-ibm-plex-mono">{period.split(' ')[0]}</span>
          </span>
        </div>
      </div>
      
      <!-- Content: either description array or slot -->
      {description && description.length > 0 ? (
        <ul class="space-y-2 sm:space-y-2 text-center sm:text-left">
          {description.map((item) => (
            <li class="text-sm sm:text-base lg:text-body text-cv-content flex flex-col sm:flex-row sm:items-start">
              <span class="mr-0 sm:mr-3 text-cv-accent hidden sm:inline">â€¢</span>
              <span class="sm:flex-1">{item}</span>
            </li>
          ))}
        </ul>
      ) : (
        <ul class="space-y-2 sm:space-y-2 text-center sm:text-left">
          <slot />
        </ul>
      )}
    </div>
  </div>
</div>